<!DOCTYPE html>
<html>
  <head>
    <title>promisify</title>
    <link rel="stylesheet" href="../build/build.css">
  </head>
  <body>
    <script src="../build/build.js"></script>
    <script>var promisify = require('promisify')</script>
    <script>
      
      function add(a, b, cb){
        setTimeout(function(){
          try {
            if ('number' != typeof a) throw new TypeError('expecting a number');
            if ('number' != typeof b) throw new TypeError('expecting a number');
            cb(null, a+b);
          }
          catch(err) {
            cb(err);
          }
        }, 0);
      }

      function pass(){
        --tests || document.write('all pass');
      }

      function assert(expr){
        if (!expr) throw new Error('failed');
      }

      var _add = promisify(add);

      var tests = 7;

      add('1', 5, function(err, res){
        assert(err instanceof TypeError);
        pass();
      });

      add(2, 4, function(err, res){
        assert(6===res);
        pass();
      });
      

      _add('1', 5, function(err, res){
        assert(err instanceof TypeError);
        pass();
      });

      _add(2,4).when(function(err, res){
        assert(6===res);
        pass();
      });

      _add(_add(2,3),4).when(function(err, res){
        assert(9===res);
        pass();
      });

      _add(_add(2,3),'4').when(function(err, res){
        assert(err instanceof TypeError);
        pass();
      });

      _add(_add(2,'3'),4).when(function(err, res){
        assert(err instanceof TypeError);
        pass();
      });

    </script>
  </body>
</html>